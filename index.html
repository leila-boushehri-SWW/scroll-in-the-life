<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A Scroll in the Life</title>
  <meta name="description" content="A simple, accessible, vertical feed for curated social posts and videos related to vision care." />

  <!-- Connection hints for third‑party embeds -->
  <link rel="dns-prefetch" href="https://www.tiktok.com">
  <link rel="preconnect" href="https://www.tiktok.com" crossorigin>
  <link rel="dns-prefetch" href="https://www.instagram.com">
  <link rel="preconnect" href="https://www.instagram.com" crossorigin>
  <link rel="dns-prefetch" href="https://platform.twitter.com">
  <link rel="preconnect" href="https://platform.twitter.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.syndication.twimg.com">
  <link rel="preconnect" href="https://cdn.syndication.twimg.com" crossorigin>

  <style>
    html, body { height: 100%; margin: 0; }
    body { font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#fff; color:#111; }
    #feed {
      height: 100dvh;
      overflow-y: auto;
      scroll-snap-type: y mandatory;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      background: #fff;
    }
    .card {
      scroll-snap-align: start;
      scroll-snap-stop: always;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
    }
    .card-scroll {
      flex: 1;
      overflow-y: auto;
      overscroll-behavior: contain;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      box-sizing: border-box;
    }
    .card-scroll > * {
      max-width: 540px;
      width: 100%;
    }
    .mediaWrap {
      display:flex; align-items:center; justify-content:center; width:100%;
    }
    .mediaWrap > * { max-width: 540px; width: 100%; }
    .tt-player {
      width: 100%;
      aspect-ratio: 9 / 16;
      max-height: 90vh;
      border: 0;
      overflow: hidden;
      pointer-events: auto;
    }
    .tiktok-embed, .instagram-media, .twitter-tweet { max-width:540px; width:100%; margin:0 auto; }
    footer { text-align:center; padding: 12px 0; color:#555; }
  
    /* --- Text Insight card styling --------------------------------------- */
    .insight {
      width: 100%;
      max-width: 540px;
      background: #f7f7f7;
      border: 1px solid #e6e6e6;
      border-radius: 12px;
      padding: 16px 18px;
      box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }
    .insight h2 {
      margin: 0 0 8px 0;
      font-size: 27px;
      line-height: 1.25;
    }
    .insight p {
      margin: 0;
      margin-top: 1em;
      color: #333;
    }

    .insight .brand-header {
      display: block;
      margin: 0 auto 12px;
      max-width: 100%;
    }

  </style>
</head>
<body>
  <main id="feed" aria-live="polite"></main>
  <footer>Built by Sense Worldwide.</footer>

  <template id="cardTpl">
    <article class="card" tabindex="0" aria-busy="true">
      <div class="card-scroll">
        <div class="mediaWrap"></div>
      </div>
    </article>
  </template>

  <script>
  (() => {
    'use strict';

    // --- Feed with text insights ------------------------------------------------------
    
    const FEED = [
      {type: 'insight',
        title: 'Gen Z live on their phones for over six hours a day. This feed has been curated to give you a glimpse into the online world of Gen Z.', 
        text: 'What\'s been going viral? \
        \\n\\n Who are they listening to? And what communities are they immersing themselves in? \
        \\n\\n How does the content they consume shape and inspire their opinions, attitudes, and behaviours? \
        \\n\\n What kind of content grabs their attention? \
        \\n\\n How do they reinterpret the world through the lens of memes and internet syntax?' },
      { type: 'tiktok', videoId: '7512105436674362655' },
      { type: 'tiktok', videoId: '7519269824963317022' },
      { type: 'tiktok', videoId: '7504960819571084566' },
      { type: 'tiktok', videoId: '7478314772165971222' },
      { type: 'tiktok', videoId: '7505130824665140482' },
      { type: 'image', src: 'images/27eada12a6d29da05b2b9ae1644347a4.jpeg' },
      { type: 'instagram', url: 'https://www.instagram.com/p/DJ6pR51g2ED/' },
      { type: 'insight', 
        title: 'Who are they listening to?', 
        text: 'Gen Z immerse themsevles in an online ecosystem of influencers, content creators, micro communities, and celebrities.' },
      { type: 'insight', 
        title: 'Influencers', 
        text: 'As the name suggests, influencers shape behaviours, opinions, and most importantly consumer choices. They earn \
        their platform through being either relatable, aspirational, or knowledgeable and therefore trustworthy of a particular \
        niche (e.g. fashion). From the user POV their engagement is driven by "I want what they have".' },
      { type: 'tiktok', videoId: '7505191102249536814' },
      { type: 'tiktok', videoId: '7157348112766373126' },
      { type: 'insight', 
        title: 'Content Creators',
        text: 'Simply put, anyone who puts out content for public viewing is considered a content creator. They often share \
        similarities with influencers, but their focus isn\’t necessarily on swaying consumer decisions. Their primary goal is to create, whether \
        that means entertaining, educating, expressing themselves, or telling stories. From the user POV their engagement is driven \
        by "I like how they make me feel".' },
      { type: 'tiktok', videoId: '7532946927286111518' },
      { type: 'tiktok', videoId: '7525213099952049438' },
      { type: 'tiktok', videoId: '7500244332872617262' },
      { type: 'insight', 
        title: 'Micro-Communities',
        text: 'People engage with micro communities that align with their interests. On Reddit this looks like joining \
        communities, and on TikTok and Instagram this translates through one\'s algorithm.' },
      { type: 'image', src: 'images/Screenshot 2025-08-20 at 12.33.54.png' },
      { type: 'image', src: 'images/Screenshot 2025-08-20 at 12.35.45.png' },
      { type: 'image', src: 'images/Screenshot 2025-08-20 at 11.31.34.png' },
      { type: 'insight', 
        title: 'Learning and Inspiration', 
        text: 'One of the main reasons Gen Z consume the content they do is to learn something or feel inspired. \
        \\n\\n Importantly, for Gen Z one point of view isn\'t enough [STAT]. They\'re obsessed with absorbing it all, \
        including people who think outside the mainstream. They are hooked on content that goes against the status quo and rallies \
        against institutional systems and their respective ideologies.' },
      { type: 'tiktok', videoId: '7341812017046539525' },
      { type: 'tiktok', videoId: '7463560337367895339' },
      { type: 'tiktok', videoId: '7395327411442732318' },
      { type: 'instagram', url: 'https://www.instagram.com/p/DLoXRGkuu11/' },
      { type: 'tiktok', videoId: '7386710528149703969' },
      { type: 'tiktok', videoId: '7527039298059668766' },
      { type: 'insight', 
        title: 'Misrepresentaton, Misinformation, and Cancel Culture', 
        text: 'Social media platforms are built to give everyone a voice. While this democratization of storytelling can be powerful, \
        it also means that extreme experiences, sensational claims, and controversial opinions spread just as easily as balanced or \
        evidence-based perspectives. \
        \\n\\n Content that provokes strong emotions, fear, shock, outrage, is far more likely to capture attention and go viral. \
        Algorithms that reward engagement then amplify these posts, creating an echo chamber where the most polarizing material \
        dominates. What begins as a single post can quickly snowball, both for the collective and for the individual. \
        \\n\\n **Doom Scrolling** \
        \\n\\n A casual search or chance encounter with one post can spiral into a rabbit hole of fear-driven content, reinforcing anxiety \
        and keeping users hooked.' },
      { type: 'insight', 
        title: 'Misrepresentation', 
        text: 'A single horror story or anomaly can achieve viral reach, often stripped of context and presented \
        as the norm. This can distort perception and drive public opinion based on exceptions rather than evidence.' },
      { type: 'tiktok', videoId: '7398375230420323614' },
      { type: 'image', src: 'images/IMG_8875.png' },
      { type: 'insight', 
        title: 'Misinformation', 
        text: 'Even with regulations and moderation, misinformation spreads easily. The gray zone of “not proven wrong, but not \
        proven right” is particularly problematic, especially when amplified on platforms with massive audiences.' },
      { type: 'tiktok', videoId: '7486518164843416837' },
      { type: 'image', src: 'images/IMG_8867.png' },
      // { type: 'image', src: 'images/image.png' },
      { type: 'insight', 
        title: 'Cancel Culture', 
        text: 'xxx.' },
      { type: 'twitter', url: 'https://x.com/banbadmen/status/1870030466381721913' },
      { type: 'insight', 
        title: 'Fluid Identity and Embracing Contradictions', 
        text: '**Fluid Identity** \
        \\n\\n Gen Z is drawn to content that reflects their sense of ever evolving identity. The digital landscape this generation \
        immerses themself in strongly champions the idea being many things all at once. They are exposed to huge swaths of new information \
        daily which has created an affinity to embracing diversity rather than pigeon holing themself to one identity. \
        \\n\\n **Embracing Contradictions** \
        \\n\\n They embrace fluidity to the point of welcoming contradictions and unexpected mash-ups. When executed well, these \
        juxtapositions create a sense of novelty, something especially valuable in today\'s sea of digital noise.' },
      { type: 'tiktok', videoId: '7123685232489958702' },
      { type: 'tiktok', videoId: '7458831430114675974' },
      // { type: 'instagram', url: 'https://www.instagram.com/p/C_ElTquy_4P/' },
      // { type: 'tiktok', videoId: '' },
      { type: 'insight', 
        title: 'Memes and Speaking in Code', 
        text: '**Memes** \
        \\n\\n If there is one thing Gen Z love, its memes. For Gen Z, memes are more than just entertainment, they\'re a generational \
        language. Memes act as shorthand for complex ideas, emotions, or cultural commentary, compressing meaning into instantly \
        recognisable formats.  Their feeds are saturated with this visual and linguistic code: meme templates, reaction images, \
        layered in-jokes, and semiotic references that rely on shared digital literacy. \
        \\n\\n **Speaking in Code** \
        \\n\\n Because of this, Gen Z is highly fluent in *meme syntax*, the grammar of remixing, reframing, and subverting \
        existing formats to create something new. What might look like nonsense to outsiders is actually a dense, context-rich \
        form of communication. Meme syntax and generational slang serve as social glue, a way to signal belonging, wit, and cultural \
        awareness in an attention economy where speed and relatability matter most.' },
      { type: 'image', src: 'images/Screenshot 2025-08-20 at 13.48.36.png' },
      { type: 'image', src: 'images/Screenshot 2025-08-20 at 14.08.25.png' },
      { type: 'image', src: 'images/4a83e976139837c2e4c3f0b27a37dc4f.jpeg' }
    ];

    const feed = document.getElementById('feed');
    const tpl  = document.getElementById('cardTpl');

    // --- TikTok Player helpers (iframe-based) --------------------------------

    const ttPlayers = new WeakMap(); // iframe -> state

    function postToPlayer(iframe, type, value) {
      try {
        iframe.contentWindow && iframe.contentWindow.postMessage({ 'x-tiktok-player': true, type, value }, '*');
      } catch {}
    }
    window.addEventListener('message', (ev) => {
      const data = ev.data || {};
      if (!data || !data['x-tiktok-player']) return;
      const iframes = Array.from(document.querySelectorAll('iframe.tt-player'));
      for (const f of iframes) {
        // We don't get a target in data, so we just mark all visible iframes ready on first ready event
        // and rely on play/pause logic to control only the intersecting one.
        const st = ttPlayers.get(f) || {};
        if (data.type === 'onPlayerReady') st.ready = true;
        if (data.type === 'onStateChange') st.state = data.value;
        ttPlayers.set(f, st);
      }
    });

    // --- Card Factory ---------------------------------------------------------
    const safeIg = (url) => {
      try {
        const u = new URL(url);
        if (!u.pathname.endsWith('/')) u.pathname += '/';
        u.search = ''; u.hash = '';
        return u.toString();
      } catch { return url; }
    };

    function makeCard(post) {
      const frag = tpl.content.cloneNode(true);
      const art = frag.querySelector('article');
      const wrap = frag.querySelector('.mediaWrap');
      const scroll = frag.querySelector('.card-scroll');

      if (post.type === 'tiktok') {
        art.dataset.kind = 'tiktok';
        art.dataset.vid = post.videoId;

        art.__mount = () => {
          const holder = document.createElement('div');
          holder.className = 'tiktok-wrap';
          holder.style.minHeight = '500px';

          // Lazy-load iframe only on mount
          const iframe = document.createElement('iframe');
          iframe.className = 'tt-player';
          iframe.src = `https://www.tiktok.com/embed/v2/${post.videoId}?lang=en`;
          iframe.allowFullscreen = true;
          iframe.setAttribute('allow', 'encrypted-media; fullscreen;');
          iframe.setAttribute('loading', 'lazy');
          iframe.frameBorder = 0;
          iframe.style.width = '100%';
          iframe.style.aspectRatio = '9 / 16';
          iframe.style.maxHeight = '90vh';       
          iframe.style.overflow = 'hidden';      
          iframe.style.pointerEvents = 'auto';

          holder.appendChild(iframe);
          wrap.appendChild(holder);

          art.setAttribute('aria-busy', 'false');
        };

        art.__unmount = () => {
          const holder = wrap.querySelector('.tiktok-wrap');
          if (holder) holder.remove(); // clean up to free memory
        };
      } else if (post.type === 'instagram') {
        art.dataset.kind = 'instagram';
        art.__mount = () => {
          const holder = document.createElement('div');
          holder.innerHTML = '<blockquote class="instagram-media" data-instgrm-captioned data-instgrm-permalink="' +
            safeIg(post.url) +
            '" data-instgrm-version="14" style="background:#FFF;border:0;border-radius:3px;box-shadow:0 0 1px rgba(0,0,0,.5),0 1px 10px rgba(0,0,0,.15);margin:1px;max-width:540px;min-width:326px;width:100%;"></blockquote>';
          wrap.appendChild(holder);
          loadScriptOnce('https://www.instagram.com/embed.js', '__ig').then(() => {
            window.instgrm && window.instgrm.Embeds && window.instgrm.Embeds.process();
          });
          art.setAttribute('aria-busy', 'false');
        };
      } else if (post.type === 'twitter') {
        art.dataset.kind = 'twitter';
        art.__mount = () => {
          const holder = document.createElement('div');
          wrap.appendChild(holder);
          const id = (post.url && (post.url.match(/status\/(\d{5,})/) || [])[1]);
          if (!id) { holder.innerHTML = '<p><a target="_blank" rel="noopener" href="'+(post.url||'#')+'">View on X</a></p>'; art.setAttribute('aria-busy','false'); return; }
          loadScriptOnce('https://platform.twitter.com/widgets.js', '__tw').then(() => {
            window.twttr && window.twttr.widgets && window.twttr.widgets.createTweet(id, holder, { align: 'center', dnt: true });
          });
          art.setAttribute('aria-busy', 'false');
        };
      } else if (post.type === 'insight') {
        art.__mount = () => {
          const box = document.createElement('section');
          box.className = 'insight';

          // Parse text: split on literal \n\n, then support **bold** and *italic*
          const paragraphs = (post.text || '')
            .split('\\n\\n')
            .map((para) => {
              const formatted = para
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>') // bold
                .replace(/\*(.+?)\*/g, '<em>$1</em>');             // italic
              return `<p>${formatted.trim()}</p>`;
            })
            .join('');

          box.innerHTML = `
            <img class="brand-header" src="images/logo.png" alt="Logo">
            <h2>${post.title || 'Insight'}</h2>
            ${paragraphs}
          `;

          wrap.appendChild(box);
          art.setAttribute('aria-busy', 'false');
        };
      } else if (post.type === 'image') {
          art.dataset.kind = 'image';
          art.__mount = () => {
            const img = document.createElement('img');
            img.src = post.src;
            img.alt = post.alt || 'Image';
            img.loading = 'lazy';
            img.style.width = '100%';
            img.style.borderRadius = '12px';
            img.style.objectFit = 'contain';
            img.style.aspectRatio = '9 / 16';
            wrap.appendChild(img);
            art.setAttribute('aria-busy', 'false');
          };
        }

      return frag;
    }

    // Load a script once
    function loadScriptOnce(src, flag) {
      return new Promise((resolve) => {
        if (window[flag]) return resolve();
        const s = document.createElement('script');
        s.async = true; s.src = src;
        s.onload = () => { window[flag] = true; resolve(); };
        s.onerror = () => resolve();
        document.head.appendChild(s);
      });
    }

    const arts = FEED.map((post) => {
      const frag = makeCard(post);
      const art = frag.querySelector('article');
      feed.appendChild(frag);
      art.__mounted = false;
      return art;
    });


    // Lazy mount + lookahead
    const rootEl = feed;
    const AHEAD = 2;
    const io = new IntersectionObserver((entries) => {
      entries.forEach((e) => {
        if (!e.isIntersecting) return;
        const art = e.target;
        // mount now
        if (typeof art.__mount === 'function') { art.__mount(); art.__mount = null; }
        // small lookahead
        const idx = arts.indexOf(art);
        for (let k = 1; k <= AHEAD; k++) {
          const n = arts[idx + k];
          if (n && typeof n.__mount === 'function') {
            (window.requestIdleCallback || window.requestAnimationFrame)(() => { n.__mount(); n.__mount = null; });
          }
        }
        io.unobserve(art);
      });
    }, { root: rootEl, rootMargin: '800px 0px', threshold: 0.01 });

    arts.forEach((a) => io.observe(a));

    // Eagerly mount first
    if (arts.length && typeof arts[0].__mount === 'function') { arts[0].__mount(); arts[0].__mount = null; }

    // --- Autoplay controller (play the card in view, pause others) -----------
    const playIo = new IntersectionObserver((entries) => {
      // We only ever want a single playing TikTok at a time
      // Pause all first
      const iframes = Array.from(document.querySelectorAll('iframe.tt-player'));
      for (const f of iframes) { postToPlayer(f, 'pause'); }

      for (const e of entries) {
        if (!e.isIntersecting) continue;
        const art = e.target;
        if (art.dataset.kind === 'tiktok') {
          const iframe = art.querySelector('iframe.tt-player');
          if (iframe) {
            postToPlayer(iframe, 'play');
          }
        }
        break; // only first visible
      }
    }, { root: rootEl, threshold: 0.6 });

    //
    const mediaIo = new IntersectionObserver((entries) => {
      for (const entry of entries) {
        const el = entry.target;
        if (entry.isIntersecting) {
          if (el.__mount && !el.__mounted) {
            el.__mount();
            el.__mounted = true;
          }
        }
      }
    }, { root: rootEl, threshold: 0.1 });

    // Start observing all cards for off-screen unmount/remount
    setTimeout(() => {
      arts.forEach((a) => mediaIo.observe(a));
    }, 300);

    // Observe only TikTok cards for autoplay
    function refreshPlayObservers() {
      arts.forEach((a) => { if (a.dataset.kind === 'tiktok') playIo.observe(a); });
    }
    // Wait a tick so some iframes exist
    setTimeout(refreshPlayObservers, 300);

    // Keyboard up/down to advance
    rootEl.addEventListener('keydown', (e) => {
      if (e.key !== 'ArrowDown' && e.key !== 'ArrowUp') return;
      e.preventDefault();
      const list = Array.from(document.querySelectorAll('.card'));
      const top0 = rootEl.getBoundingClientRect().top;
      let idx = 0, min = Infinity;
      for (let i = 0; i < list.length; i++) {
        const top = Math.abs(list[i].getBoundingClientRect().top - top0);
        if (top < min) { min = top; idx = i; }
      }
      const next = e.key === 'ArrowDown' ? Math.min(idx+1, list.length-1) : Math.max(idx-1, 0);
      list[next].scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, { passive: false });

  })();
  </script>
</body>
</html>
